<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC
"-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board-mapper">
	
	<resultMap id="boardMap" type="Board">
		<result column="B_NO" property="bno"/>
		<result column="BTYPE_NO" property="btype"/>
		<result column="U_NO" property="uno"/>
		<result column="BCATEGORY" property="bCategory"/>
		<result column="B_TITLE" property="bTitle"/>
		<result column="B_CONTENT" property="bContent"/>
		<result column="B_ENROLLDATE" property="bDate"/>
		<result column="B_COUNT" property="bCount"/>
		<result column="B_STATUS" property="bStatus"/>
		<result column="RM" property="bnum"/>
		<result column="N_NAME" property="writer"/>
	</resultMap>

	<select id="getListCount" resultType="int">
		SELECT COUNT(*) FROM BOARD
	</select>

	<select id="selectBoard" parameterType="PageInfo" resultMap="boardMap">
		<![CDATA[  SELECT * FROM 
		 (SELECT B.*, ROWNUM RNUM 
                  FROM(SELECT BD.*,M.N_NAME 
                      	 FROM (SELECT ROWNUM RM, BDD.* ,C_COUNT
                       			FROM BOARD BDD 
                       			 LEFT JOIN (SELECT B_NO,COUNT(*) C_COUNT FROM BOARD_COMMENT GROUP BY B_NO) C ON (BDD.B_NO = C.B_NO)
                      			 WHERE B_STATUS='N') BD 
                       JOIN MEMBER M ON (BD.U_NO=M.U_NO)
                        WHERE B_STATUS='N' 
                        ORDER BY B_ENROLLDATE DESC) B 
                 WHERE ROWNUM <= #{endRow})
         WHERE RNUM >#{startRow}
			]]>
	</select>
	<select id="selectOneBoard" parameterType="int" resultMap = "boardMap">
		SELECT B.*,M.N_NAME 
		FROM BOARD B 
		JOIN MEMBER M ON (B.U_NO = M.U_NO)  
		WHERE B_NO = #{bno}
	</select>
	<insert id="insertBoard" parameterType="Board">
		INSERT INTO BOARD VALUES(SEQ_B_NO.NEXTVAL,
								 1, 1, '자랑', 
								 #{bTitle}, #{bContent},
								  DEFAULT, DEFAULT, DEFAULT)
	</insert>
	<update id="addReadCount" parameterType="int">
		UPDATE BOARD SET B_COUNT=B_COUNT+1 WHERE B_NO= #{bno}
	</update>
	<update id="updateBoard" parameterType="Board">
		UPDATE BOARD SET B_TITLE = #{bTitle},B_CONTENT=#{bContent} WHERE B_NO = #{bno}
	</update>
	<update id="deleteBoard" parameterType="int">
		UPDATE BOARD SET B_STATUS = 'Y' WHERE B_NO = #{bno}
	</update>
</mapper>